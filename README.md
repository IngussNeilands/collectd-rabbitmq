# Collectd RabbitMQ Plugin

## Introduction

collectd-rabbitmq is a [collectd](http://www.collectd.org/) plugin that
collects statistics from RabbitMQ. The plugin uses the [RabbitMQ Management HTTP API](http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_3_4/priv/www/api/index.html)
to poll for statistics on a RabbitMQ server, then reports them to collectd.

When collectd is configured to publish metrics to SignalFx, metrics from this
plugin will be named according to the format:
`<metric type>.<category>.<statistic>`

For example:

```
gauge.connection.recv_oct_details.rate
counter.connection.send_oct
gauge.queue.message_stats.deliver_get_details.rate
```

## Requirements

* Collectd 4.9 or later (for the Python plugin)
* Python 2.6 or later
* RabbitMQ 3.0 or later
* RabbitMQ Management Plugin

## Configuration

The following mandatory configuration options describe how the plugin will
connect to the RabbitMQ Management API:

* Username - the username for authentication
* Password - the password for authentication
* Host - hostname or IP address of the RabbitMQ server running the RabbitMQ
         Management Plugin
* Port - the port of the RabbitMQ Management API

The following boolean configuration options may be added to enable collection
of specific statistics:

* CollectChannels - enables collection of channel statistics
* CollectConnections - enables collection of connection statistics
* CollectExchanges - enables collection of exchange statistics
* CollectNodes - enables collection of node statistics
* CollectQueues - enables collection of queue statistics

An additional configuration option is available:

* HTTPTimeout - Integer value in seconds before timing out when connecting
                to the RabbitMQ Management API. Defaults to 1 second.
* FieldLength - Set the number of characters used to encode dimension data.
                This option should only ever be set if you specifically
                compiled collectd with a non-default value for
                DATA_MAX_NAME_LEN in plugin.h.

The following is an example Collectd configuration for this plugin:

```
    LoadPlugin python
    <Plugin python>
      ModulePath "/opt/collectd-rabbitmq"

      Import rabbitmq
      <Module rabbitmq>
        Username "guest"
        Password "guest"
        Host "localhost"
        Port "15672"
        CollectChannels true
        CollectConnections true
        CollectExchanges true
        CollectNodes true
        CollectQueues true
        HTTPTimeout 5
      </Module>
    </Plugin>
```

## Known Issues

### Truncating of long dimensions in the plugin_instance field

Collectd has a 64-byte limit on the plugin_instance field, which this plugin
uses to post dimensions to SignalFx. The dimensions include the node name,
vhost name, and queue name.
The combination of these names as generated by RabbitMQ may exceed 64
characters. As a result, the dimensions posted to SignalFx (usually the
queue name) may be truncated.

This has no effect on the metrics and values to SignalFx, only some of the
RabbitMQ-specific dimensions associated with those metrics.
